{{ define "main" }}
<section class="contact-page">
  <h1>{{ .Title }}</h1>
  <p class="contact-intro">Have a question, want to collaborate, or just want to say hello? Send me a message and I'll get back to you.</p>

  <form id="contact-form" class="contact-form" method="POST" action="/api/contact">
    <div class="form-group">
      <label for="name">Name</label>
      <input type="text" id="name" name="name" required autocomplete="name">
    </div>

    <div class="form-group">
      <label for="email">Email</label>
      <input type="email" id="email" name="email" required autocomplete="email">
    </div>

    <div class="form-group">
      <label for="message">Message</label>
      <textarea id="message" name="message" rows="6" required></textarea>
    </div>

    {{/* Honeypot field: hidden from users, bots fill it in */}}
    <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off" aria-hidden="true">

    {{/* Turnstile widget */}}
    <div class="cf-turnstile" data-sitekey="{{ .Site.Params.turnstileSiteKey }}" data-theme="auto"></div>

    <button type="submit" class="form-submit">Send Message</button>
  </form>

  <div id="form-success" class="form-message form-message-success" hidden>
    <p>Thanks for reaching out! I'll get back to you soon.</p>
  </div>

  <div id="form-error" class="form-message form-message-error" hidden>
    <p>Something went wrong. Please try again, or email me directly at <a href="mailto:{{ .Site.Params.email }}">{{ .Site.Params.email }}</a>.</p>
  </div>
</section>

<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
<script>
  document.getElementById('contact-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const form = e.target;
    const submitBtn = form.querySelector('.form-submit');
    const successEl = document.getElementById('form-success');
    const errorEl = document.getElementById('form-error');

    submitBtn.disabled = true;
    submitBtn.textContent = 'Sending...';
    successEl.hidden = true;
    errorEl.hidden = true;

    try {
      const res = await fetch(form.action, {
        method: 'POST',
        body: new FormData(form),
      });

      if (res.ok) {
        form.hidden = true;
        successEl.hidden = false;
      } else {
        errorEl.hidden = false;
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
      }
    } catch {
      errorEl.hidden = false;
      submitBtn.disabled = false;
      submitBtn.textContent = 'Send Message';
    }
  });
</script>
{{ end }}
